var AuthenticationContext=function(){AuthenticationContext=function(a){this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"};this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",NONCE_IDTOKEN:"adal.nonce.idtoken",
SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",RENEW_STATUS:"adal.token.renew.status"},RESOURCE_DELIMETER:"|",LOADFRAME_TIMEOUT:"6000",TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",
1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600};if(AuthenticationContext.prototype._singletonInstance)return AuthenticationContext.prototype._singletonInstance;AuthenticationContext.prototype._singletonInstance=this;this.instance="https://login.microsoftonline.com/";this.config={};this.callback=null;this.isAngular=this.popUp=!1;this._user=null;this._activeRenewals={};this._acquireTokenInProgress=this._loginInProgress=!1;window.renewStates=[];window.callBackMappedToRenewStates=
{};window.callBacksMappedToRenewStates={};if(a.displayCall&&"function"!==typeof a.displayCall)throw Error("displayCall is not a function");if(!a.clientId)throw Error("clientId is required");this.config=this._cloneConfig(a);void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0);this.config.popUp&&(this.popUp=!0);this.config.callback&&"function"===typeof this.config.callback&&(this.callback=this.config.callback);this.config.instance&&(this.instance=this.config.instance);
this.config.loginResource||(this.config.loginResource=this.config.clientId);this.config.redirectUri||(this.config.redirectUri=window.location.href.split("?")[0].split("#")[0]);this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split("?")[0].split("#")[0]);this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]);this.config.isAngular&&(this.isAngular=this.config.isAngular)};window.Logging={level:0,log:function(a){}};AuthenticationContext.prototype.login=
function(a){if(this._loginInProgress)this.info("Login in progress");else{var b=this._guid();this.config.state=b;this._idTokenNonce=this._guid();this.verbose("Expected state: "+b+" startPage:"+window.location.href);this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,a||window.location.href);this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,b);this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce);this._saveItem(this.CONSTANTS.STORAGE.ERROR,
"");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");a=this._getNavigateUrl("id_token",null)+"&nonce="+encodeURIComponent(this._idTokenNonce);this._loginInProgress=!0;this.config.displayCall?this.config.displayCall(a):this.popUp?this._loginPopup(a):this.promptUser(a)}};AuthenticationContext.prototype._openPopup=function(a,b,c,d){try{var e=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)/2-c/2+(window.screenLeft?window.screenLeft:window.screenX),f=(window.innerHeight||
document.documentElement.clientHeight||document.body.clientHeight)/2-d/2+(window.screenTop?window.screenTop:window.screenY),g=(/\bElectron/g.test(navigator.userAgent)?window.parent.open:window.open)(a,b,"width="+c+", height="+d+", top="+f+", left="+e);g.focus&&g.focus();return g}catch(h){return this.warn("Error opening popup, "+h.message),this._loginInProgress=!1,null}};AuthenticationContext.prototype._loginPopup=function(a,b,c){var d=this._openPopup(a,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT);
a=c||this.callback;if(null==d)this.warn("Popup Window is null. This can happen if you are using IE"),this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Error opening popup"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Popup Window is null. This can happen if you are using IE"),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Popup Window is null. This can happen if you are using IE"),b&&this._activeRenewals[b]&&(this._activeRenewals[b]=null),this._acquireTokenInProgress=this._loginInProgress=
!1,a&&a(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION),null,this._getItem(this.CONSTANTS.STORAGE.ERROR));else var e=-1!=this.config.redirectUri.indexOf("#")?this.config.redirectUri.split("#")[0]:this.config.redirectUri,f=this,g=window.setInterval(function(){if(!d||d.closed||void 0===d.closed)f._loginInProgress=!1,f._acquireTokenInProgress=!1,b&&f._activeRenewals[b]&&(f._activeRenewals[b]=null),window.clearInterval(g);try{var a=d.location.href||d.location;if(-1!=a.indexOf(e)){var c=a.split("#")[1];
f.isAngular?f._onPopUpHashChanged(c):f.handleWindowCallback(c);window.clearInterval(g);f._loginInProgress=!1;f._acquireTokenInProgress=!1;f.info("Closing popup window");d.close()}}catch(l){}},1)};AuthenticationContext.prototype._onPopUpHashChanged=function(a){(function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return c}if("function"===typeof window.CustomEvent)return!1;a.prototype=
window.Event.prototype;window.CustomEvent=a})();a=new CustomEvent("adal:popUpHashChanged",{detail:a});window.dispatchEvent(a)};AuthenticationContext.prototype.loginInProgress=function(){return this._loginInProgress};AuthenticationContext.prototype._hasResource=function(a){var b=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return b&&!this._isEmpty(b)&&-1<b.indexOf(a+this.CONSTANTS.RESOURCE_DELIMETER)};AuthenticationContext.prototype.getCachedToken=function(a){if(!this._hasResource(a))return null;
var b=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+a),c=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+a),d=this.config.expireOffsetSeconds||300;if(c&&c>this._now()+d)return b;this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+a,"");this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+a,0);return null};AuthenticationContext.prototype.getCachedUser=function(){if(this._user)return this._user;var a=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(a)};
AuthenticationContext.prototype.registerCallback=function(a,b,c){this._activeRenewals[b]=a;window.callBacksMappedToRenewStates[a]||(window.callBacksMappedToRenewStates[a]=[]);var d=this;window.callBacksMappedToRenewStates[a].push(c);window.callBackMappedToRenewStates[a]||(window.callBackMappedToRenewStates[a]=function(c,f,g){d._activeRenewals[b]=null;for(var e=0;e<window.callBacksMappedToRenewStates[a].length;++e)try{window.callBacksMappedToRenewStates[a][e](c,f,g)}catch(k){d.warn(k)}window.callBacksMappedToRenewStates[a]=
null;window.callBackMappedToRenewStates[a]=null})};AuthenticationContext.prototype._renewToken=function(a,b){this.info("renewToken is called for resource:"+a);var c=this._addAdalFrame("adalRenewFrame"+a),d=this._guid()+"|"+a;this.config.state=d;window.renewStates.push(d);this.verbose("Renew token Expected state: "+d);var e=this._getNavigateUrl("token",a)+"&prompt=none",e=this._addHintParameters(e);this.registerCallback(d,a,b);this.verbose("Navigate to:"+e);c.src="about:blank";this._loadFrameTimeout(e,
"adalRenewFrame"+a,a)};AuthenticationContext.prototype._renewIdToken=function(a){this.info("renewIdToken is called");var b=this._addAdalFrame("adalIdTokenFrame"),c=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid();this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce);this.config.state=c;window.renewStates.push(c);this.verbose("Renew Idtoken Expected state: "+c);var d=this._getNavigateUrl("id_token",null)+"&prompt=none",d=this._addHintParameters(d),d=d+("&nonce="+
encodeURIComponent(this._idTokenNonce));this.registerCallback(c,this.config.clientId,a);this.idTokenNonce=null;this.verbose("Navigate to:"+d);b.src="about:blank";this._loadFrameTimeout(d,"adalIdTokenFrame",this.config.clientId)};AuthenticationContext.prototype._urlContainsQueryStringParameter=function(a,b){return(new RegExp("[\\?&]"+a+"=")).test(b)};AuthenticationContext.prototype._loadFrameTimeout=function(a,b,c){this.verbose("Set loading state to pending for: "+c);this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+
c,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS);this._loadFrame(a,b);var d=this;setTimeout(function(){if(d._getItem(d.CONSTANTS.STORAGE.RENEW_STATUS+c)===d.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){d.verbose("Loading frame has timed out after: "+d.CONSTANTS.LOADFRAME_TIMEOUT/1E3+" seconds for resource "+c);var a=d._activeRenewals[c];if(a&&window.callBackMappedToRenewStates[a])window.callBackMappedToRenewStates[a]("Token renewal operation failed due to timeout",null,"Token Renewal Failed");d._saveItem(d.CONSTANTS.STORAGE.RENEW_STATUS+
c,d.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}},d.CONSTANTS.LOADFRAME_TIMEOUT)};AuthenticationContext.prototype._loadFrame=function(a,b){var c=this;c.info("LoadFrame: "+b);setTimeout(function(){var d=c._addAdalFrame(b);if(""===d.src||"about:blank"===d.src)d.src=a,c._loadFrame(a,b)},500)};AuthenticationContext.prototype.acquireToken=function(a,b){if(this._isEmpty(a))this.warn("resource is required"),b("resource is required",null,"resource is required");else{var c=this.getCachedToken(a);c?(this.info("Token is already in cache for resource:"+
a),b(null,c,null)):this._user?this._activeRenewals[a]?this.registerCallback(this._activeRenewals[a],a,b):a===this.config.clientId?(this.verbose("renewing idtoken"),this._renewIdToken(b)):this._renewToken(a,b):(this.warn("User login is required"),b("User login is required",null,"login required"))}};AuthenticationContext.prototype.acquireTokenPopup=function(a,b,c,d){if(this._isEmpty(a))this.warn("resource is required"),d("resource is required",null,"resource is required");else if(this._user)if(this._acquireTokenInProgress)this.warn("Acquire token interactive is already in progress"),
d("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");else{var e=this._guid()+"|"+a;this.config.state=e;window.renewStates.push(e);this.verbose("Renew token Expected state: "+e);var f=this._getNavigateUrl("token",a)+"&prompt=select_account";b&&(f+=encodeURIComponent(b));if(c&&-1===f.indexOf("&claims"))f+="&claims="+encodeURIComponent(c);else if(c&&-1!==f.indexOf("&claims"))throw Error("Claims cannot be passed as an extraQueryParameter");f=this._addHintParameters(f);
this._acquireTokenInProgress=!0;this.info("acquireToken interactive is called for the resource "+a);this.registerCallback(e,a,d);this._loginPopup(f,a,d)}else this.warn("User login is required"),d("User login is required",null,"login required")};AuthenticationContext.prototype.acquireTokenRedirect=function(a,b,c){if(this._isEmpty(a))this.warn("resource is required"),callback("resource is required",null,"resource is required");else if(this._user)if(this._acquireTokenInProgress)this.warn("Acquire token interactive is already in progress"),
callback("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");else{var d=this._guid()+"|"+a;this.config.state=d;window.renewStates.push(d);this.verbose("Renew token Expected state: "+d);var e=this._getNavigateUrl("token",a)+"&prompt=select_account";b&&(e+=encodeURIComponent(b));if(c&&-1===e.indexOf("&claims"))e+="&claims="+encodeURIComponent(c);else if(c&&-1!==e.indexOf("&claims"))throw Error("Claims cannot be passed as an extraQueryParameter");
e=this._addHintParameters(e);this._acquireTokenInProgress=!0;this.info("acquireToken interactive is called for the resource "+a);this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location.href);this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,d);this.promptUser(e)}else this.warn("User login is required"),callback("User login is required",null,"login required")};AuthenticationContext.prototype.promptUser=function(a){a?(this.info("Navigate to:"+a),window.location.replace(a)):this.info("Navigate url is empty")};
AuthenticationContext.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY,"");this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY,0);this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,"");this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,"");window.renewStates=[];this._saveItem(this.CONSTANTS.STORAGE.USERNAME,"");this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,
"");var a=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(a))for(var a=a.split(this.CONSTANTS.RESOURCE_DELIMETER),b=0;b<a.length;b++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+a[b],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+a[b],0);this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")};AuthenticationContext.prototype.clearCacheForResource=function(a){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,
"");this._hasResource(a)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+a,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+a,0))};AuthenticationContext.prototype.logOut=function(){this.clearCache();this._user=null;var a;if(this.config.logOutUri)a=this.config.logOutUri;else{a="common";var b="";this.config.tenant&&(a=this.config.tenant);this.config.postLogoutRedirectUri&&(b="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri));a=this.instance+a+"/oauth2/logout?"+
b}this.info("Logout navigate to: "+a);this.promptUser(a)};AuthenticationContext.prototype._isEmpty=function(a){return"undefined"===typeof a||!a||0===a.length};AuthenticationContext.prototype.getUser=function(a){if("function"!==typeof a)throw Error("callback is not a function");if(this._user)a(null,this._user);else{var b=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(b)?(this.warn("User information is not available"),a("User information is not available",null)):(this.info("User exists in cache: "),
this._user=this._createUser(b),a(null,this._user))}};AuthenticationContext.prototype._addHintParameters=function(a){if(this._user&&this._user.profile&&this._user.profile.hasOwnProperty("upn")&&(this._urlContainsQueryStringParameter("login_hint",a)||(a+="&login_hint="+encodeURIComponent(this._user.profile.upn)),!this._urlContainsQueryStringParameter("domain_hint",a)&&-1<this._user.profile.upn.indexOf("@"))){var b=this._user.profile.upn.split("@");a+="&domain_hint="+encodeURIComponent(b[b.length-1])}return a};
AuthenticationContext.prototype._createUser=function(a){var b=null;(a=this._extractIdToken(a))&&a.hasOwnProperty("aud")&&(a.aud.toLowerCase()===this.config.clientId.toLowerCase()?(b={userName:"",profile:a},a.hasOwnProperty("upn")?b.userName=a.upn:a.hasOwnProperty("email")&&(b.userName=a.email)):this.warn("IdToken has invalid aud field"));return b};AuthenticationContext.prototype._getHash=function(a){-1<a.indexOf("#/")?a=a.substring(a.indexOf("#/")+2):-1<a.indexOf("#")&&(a=a.substring(1));return a};
AuthenticationContext.prototype.isCallback=function(a){a=this._getHash(a);a=this._deserialize(a);return a.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||a.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||a.hasOwnProperty(this.CONSTANTS.ID_TOKEN)};AuthenticationContext.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)};AuthenticationContext.prototype.getRequestInfo=function(a){a=this._getHash(a);var b=this._deserialize(a);a={valid:!1,parameters:{},stateMatch:!1,
stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(b&&(a.parameters=b,b.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||b.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||b.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){a.valid=!0;if(b.hasOwnProperty("state"))this.verbose("State: "+b.state),b=b.state;else return this.warn("No state returned"),a;a.stateResponse=b;if(b===this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN))return a.requestType=this.REQUEST_TYPE.LOGIN,a.stateMatch=!0,a;if(b===this._getItem(this.CONSTANTS.STORAGE.STATE_RENEW))return a.requestType=
this.REQUEST_TYPE.RENEW_TOKEN,a.stateMatch=!0,a;if(!a.stateMatch&&window.parent)for(var b=window.parent.renewStates,c=0;c<b.length;c++)if(b[c]===a.stateResponse){a.requestType=this.REQUEST_TYPE.RENEW_TOKEN;a.stateMatch=!0;break}}return a};AuthenticationContext.prototype._getResourceFromState=function(a){if(a){var b=a.indexOf("|");if(-1<b&&b+1<a.length)return a.substring(b+1)}return""};AuthenticationContext.prototype.saveTokenFromHash=function(a){this.info("State status:"+a.stateMatch+"; Request type:"+
a.requestType);this._saveItem(this.CONSTANTS.STORAGE.ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var b=this._getResourceFromState(a.stateResponse);if(a.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION))this.info("Error :"+a.parameters.error+"; Error description:"+a.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,a.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,a.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),
a.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,a.parameters.error_description));else if(a.stateMatch){this.info("State is right");a.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,a.parameters[this.CONSTANTS.SESSION_STATE]);var c;a.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),this._hasResource(b)||(c=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||
"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,c+b+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+b,a.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+b,this._expiresIn(a.parameters[this.CONSTANTS.EXPIRES_IN])));a.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,(this._user=this._createUser(a.parameters[this.CONSTANTS.ID_TOKEN]))&&this._user.profile?
this._user.profile.nonce!==this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)?(this._user=null,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce is not same as "+this._idTokenNonce)):(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,a.parameters[this.CONSTANTS.ID_TOKEN]),b=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(b)||(c=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,c+b+this.CONSTANTS.RESOURCE_DELIMETER)),
this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+b,a.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+b,this._user.profile.exp)):(this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+a.parameters[this.CONSTANTS.ID_TOKEN])))}else this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+
a.stateResponse);this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+b,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)};AuthenticationContext.prototype.getResourceForEndpoint=function(a){if(this.config&&this.config.anonymousEndpoints)for(var b=0;b<this.config.anonymousEndpoints.length;b++)if(-1<a.indexOf(this.config.anonymousEndpoints[b]))return null;if(this.config&&this.config.endpoints)for(var c in this.config.endpoints)if(-1<a.indexOf(c))return this.config.endpoints[c];if(-1<a.indexOf("http://")||
-1<a.indexOf("https://")){if(this._getHostFromUri(a)===this._getHostFromUri(this.config.redirectUri))return this.config.loginResource}else return this.config.loginResource;return null};AuthenticationContext.prototype._getHostFromUri=function(a){a=String(a).replace(/^(https?:)\/\//,"");return a=a.split("/")[0]};AuthenticationContext.prototype.handleWindowCallback=function(a){null==a&&(a=window.location.hash);if(this.isCallback(a)){a=this.getRequestInfo(a);this.info("Returned from redirect url");this.saveTokenFromHash(a);
var b=null,c=null;a.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent?(this.verbose("Window is in iframe"),c=window.parent.callBackMappedToRenewStates[a.stateResponse],b=a.parameters[this.CONSTANTS.ACCESS_TOKEN]||a.parameters[this.CONSTANTS.ID_TOKEN]):a.requestType===this.REQUEST_TYPE.LOGIN&&(c=this.callback,b=a.parameters[this.CONSTANTS.ID_TOKEN]);try{c&&c(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION),b,this._getItem(this.CONSTANTS.STORAGE.ERROR))}catch(d){this.error("Error occurred in user defined callback function",
d)}this.popUp||(window.location.hash="",this.config.navigateToLoginRequestUrl&&(window.location.href=this._getItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST)))}};AuthenticationContext.prototype._getNavigateUrl=function(a,b){var c="common";this.config.tenant&&(c=this.config.tenant);a=this.instance+c+"/oauth2/authorize"+this._serialize(a,this.config,b)+this._addLibMetadata();this.info("Navigate url:"+a);return a};AuthenticationContext.prototype._extractIdToken=function(a){a=this._decodeJwt(a);if(!a)return null;
try{var b=this._base64DecodeStringUrlSafe(a.JWSPayload);return b?JSON.parse(b):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(c){this.error("The returned id_token could not be decoded",c)}return null};AuthenticationContext.prototype._base64DecodeStringUrlSafe=function(a){a=a.replace(/-/g,"+").replace(/_/g,"/");return window.atob?decodeURIComponent(escape(window.atob(a))):decodeURIComponent(escape(this._decode(a)))};AuthenticationContext.prototype._decode=function(a){a=
String(a).replace(/=+$/,"");var b=a.length;if(1===b%4)throw Error("The token to be decoded is not correctly encoded.");for(var c,d,e,f,g="",h=0;h<b;h+=4){c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h));d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h+1));e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h+2));f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h+
3));if(h+2===b-1){e=c<<18|d<<12|e<<6;c=e>>16&255;d=e>>8&255;g+=String.fromCharCode(c,d);break}else if(h+1===b-1){e=c<<18|d<<12;c=e>>16&255;g+=String.fromCharCode(c);break}e=c<<18|d<<12|e<<6|f;c=e>>16&255;d=e>>8&255;e&=255;g+=String.fromCharCode(c,d,e)}return g};AuthenticationContext.prototype._decodeJwt=function(a){if(this._isEmpty(a))return null;a=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(a);return!a||4>a.length?(this.warn("The returned id_token is not parseable."),null):{header:a[1],JWSPayload:a[2],
JWSSig:a[3]}};AuthenticationContext.prototype._convertUrlSafeToRegularBase64EncodedString=function(a){return a.replace("-","+").replace("_","/")};AuthenticationContext.prototype._serialize=function(a,b,c){var d=[];null!==b&&(d.push("?response_type="+a),d.push("client_id="+encodeURIComponent(b.clientId)),c&&d.push("resource="+encodeURIComponent(c)),d.push("redirect_uri="+encodeURIComponent(b.redirectUri)),d.push("state="+encodeURIComponent(b.state)),b.hasOwnProperty("slice")&&d.push("slice="+encodeURIComponent(b.slice)),
b.hasOwnProperty("extraQueryParameter")&&d.push(b.extraQueryParameter),a=b.correlationId?b.correlationId:this._guid(),d.push("client-request-id="+encodeURIComponent(a)));return d.join("&")};AuthenticationContext.prototype._deserialize=function(a){var b,c=/\+/g,d=/([^&=]+)=([^&]*)/g,e={};for(b=d.exec(a);b;)e[decodeURIComponent(b[1].replace(c," "))]=decodeURIComponent(b[2].replace(c," ")),b=d.exec(a);return e};AuthenticationContext.prototype._decimalToHex=function(a){for(a=a.toString(16);2>a.length;)a=
"0"+a;return a};AuthenticationContext.prototype._guid=function(){var a=window.crypto||window.msCrypto;if(a&&a.getRandomValues){var b=new Uint8Array(16);a.getRandomValues(b);b[6]|=64;b[6]&=79;b[8]|=128;b[8]&=191;return this._decimalToHex(b[0])+this._decimalToHex(b[1])+this._decimalToHex(b[2])+this._decimalToHex(b[3])+"-"+this._decimalToHex(b[4])+this._decimalToHex(b[5])+"-"+this._decimalToHex(b[6])+this._decimalToHex(b[7])+"-"+this._decimalToHex(b[8])+this._decimalToHex(b[9])+"-"+this._decimalToHex(b[10])+
this._decimalToHex(b[11])+this._decimalToHex(b[12])+this._decimalToHex(b[13])+this._decimalToHex(b[14])+this._decimalToHex(b[15])}for(var a=0,b="",c=0;36>c;c++)"-"!=="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[c]&&"4"!=="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[c]&&(a=16*Math.random()|0),"x"==="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[c]?b+="0123456789abcdef"[a]:"y"==="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[c]?(a&=3,a|=8,b+="0123456789abcdef"[a]):b+="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[c];return b};AuthenticationContext.prototype._expiresIn=
function(a){a||(a=3599);return this._now()+parseInt(a,10)};AuthenticationContext.prototype._now=function(){return Math.round((new Date).getTime()/1E3)};AuthenticationContext.prototype._addAdalFrame=function(a){if("undefined"!==typeof a){this.info("Add adal frame to document:"+a);var b=document.getElementById(a);b||(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))?(b=document.createElement("iframe"),b.setAttribute("id",a),b.style.visibility=
"hidden",b.style.position="absolute",b.style.width=b.style.height=b.borderWidth="0px",b=document.getElementsByTagName("body")[0].appendChild(b)):document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+a+'" id="'+a+'" style="display:none"></iframe>'),window.frames&&window.frames[a]&&(b=window.frames[a]));return b}};AuthenticationContext.prototype._saveItem=function(a,b){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage())return this.info("Local storage is not supported"),
!1;localStorage.setItem(a,b);return!0}if(!this._supportsSessionStorage())return this.info("Session storage is not supported"),!1;sessionStorage.setItem(a,b);return!0};AuthenticationContext.prototype._getItem=function(a){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(a):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(a):(this.info("Session storage is not supported"),
null)};AuthenticationContext.prototype._supportsLocalStorage=function(){try{if(!window.localStorage)return!1;window.localStorage.setItem("storageTest","A");if("A"!=window.localStorage.getItem("storageTest"))return!1;window.localStorage.removeItem("storageTest");return window.localStorage.getItem("storageTest")?!1:!0}catch(a){return!1}};AuthenticationContext.prototype._supportsSessionStorage=function(){try{if(!window.sessionStorage)return!1;window.sessionStorage.setItem("storageTest","A");if("A"!=
window.sessionStorage.getItem("storageTest"))return!1;window.sessionStorage.removeItem("storageTest");return window.sessionStorage.getItem("storageTest")?!1:!0}catch(a){return!1}};AuthenticationContext.prototype._cloneConfig=function(a){if(null===a||"object"!==typeof a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};AuthenticationContext.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()};AuthenticationContext.prototype.log=function(a,
b,c){if(a<=Logging.level){var d=(new Date).toUTCString();a=this.config.correlationId?d+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[a]+" "+b:d+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[a]+" "+b;c&&(a+="\nstack:\n"+c.stack);Logging.log(a)}};AuthenticationContext.prototype.error=function(a,b){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,a,b)};AuthenticationContext.prototype.warn=function(a){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,a,null)};
AuthenticationContext.prototype.info=function(a){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,a,null)};AuthenticationContext.prototype.verbose=function(a){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,a,null)};AuthenticationContext.prototype._libVersion=function(){return"1.0.15"};"undefined"!==typeof module&&module.exports&&(module.exports=AuthenticationContext,module.exports.inject=function(a){return new AuthenticationContext(a)});return AuthenticationContext}();